<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cinema Seating</title>
  <style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: #f1ecec;
  color: #333;
  text-align: center;
  padding: 0 0;
}

h1 {
  color: #222;
  margin-bottom: 20px;
  background-color: #4d4d4d;
  font-size: 25px;
  color: white;
  padding: 5px;
}

.controls {
  background: linear-gradient(to right, #1f1f1f, #3c8049);
  padding: 20px 25px;
  margin: 0 auto 30px;
  border-radius: 12px;
  display: inline-flex;
  gap: 12px;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
  color: white;
}

.controls label {
  font-size: 16px;
  font-weight: 500;
}

.controls input[type="number"] {
  width: 60px;
  padding: 8px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.controls button {
  padding: 10px 14px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
  background-color: #333;
  color: white;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.2s ease;
  box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}

.controls button:hover {
  background-color: #222;
  transform: scale(1.05);
}

.screen {
  margin: 0 auto 20px;
  width: 60%;
  height: 30px;
  background: linear-gradient(to bottom, #46788d, #2310b5);
  color: #ffffff;
  font-weight: bold;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px 4px 12px 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  transform: perspective(500px) rotateX(-25deg);
  transform-origin: bottom;
}

.cinema {
  display: grid;
  grid-template-columns: repeat(23, 44px);
  gap: 6px;
  justify-content: center;
  margin: 30px auto;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

.seat, .empty-space {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: bold;
  border-radius: 6px;
  color: white;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  transition: transform 0.2s ease;
}

.seat:hover {
  transform: scale(1.08);
}

.available    { background-color: #06c10d; }
.occupied     { background-color: #fd7419; cursor: not-allowed; }
.vip          { background-color: #6e0ed5; }
.accessible   { background-color: #f000f0; }
.broken       { background-color: #8d8686; cursor: not-allowed; }

.empty-space {
  background: transparent;
  box-shadow: none;
}
.less-popular { outline: 3px dotted #6c757d; }  
.most-popular { outline: 3px solid #ffc107 }   
.popular      { outline: 3px dashed #17a2b8; }   
.legend {
  margin-top: 30px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}

.color-box {
  width: 20px;
  height: 20px;
  border-radius: 4px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
}

.footer {
  margin-top: 40px;
  font-size: 13px;
  color: #888;
}
  </style>
</head>
<body>
  <h1 class="header">Cinema Seating Booking with your Groups...</h1>

  <div class="controls">
    <label for="groupSize"><strong>Group Size:</strong></label>
    <input type="number" id="groupSize" value="4" min="2" max="7">
    <button onclick="addGroup()">üéüÔ∏è Add Group</button>
    <button onclick="assignIndividual()">üë§ Add Solo</button>
    <button onclick="cancelLastBooking()">‚ùå Cancel Last Booking</button>
    <button onclick="resetSeating()">üîÑ Reset Seating</button>
    <label><input type="checkbox" id="adminOverride"> <strong>Admin Override</strong></label>
  </div>

  <div class="legend">
    <div class="legend-item"><div class="color-box available"></div> Available</div>
    <div class="legend-item"><div class="color-box occupied"></div> Occupied</div>
    <div class="legend-item"><div class="color-box vip"></div> VIP</div>
    <div class="legend-item"><div class="color-box accessible"></div> Accessible</div>
    <div class="legend-item"><div class="color-box broken"></div> Broken</div>
    <div class="legend-item"><div class="color-box" style="border:3px solid #ffc107;"></div> Most Popular Row</div>
    <div class="legend-item"><div class="color-box" style="border:3px dashed #17a2b8;"></div> Popular Row</div>
    <div class="legend-item"><div class="color-box" style="border:3px dotted #6c757d;"></div> Less Popular Row</div>
  </div>

  <br>
  <div class="screen">üé¨ CINEMA SCREEN</div>
  <div id="cinema" class="cinema"></div>
  <div class="footer">ATSE-CINEMA INTELLIGENT BOOKINGS &copy; 2025</div>

  <script>
const rows = 10;
const cols = 23;
const seatCols = [...Array(cols).keys()].filter(c => c !== 8 && c !== 14);
const vipSeats = [[5,3],[5,4],[5,5],[5,6],[5,7],[4,9],[4,10],[4,11],[4,12],[4,13],[5,15],[5,16],[5,17],[5,18],[5,19]];
const accessibleSeats = [[9,0],[9,1],[0,6],[0,5],[0,11],[0,16]];
const brokenChance = 0.1;

let grid = [];
let groupCounter = 1;
let bookingHistory = [];

const mostPopularRows = [3, 4, 5, 6];
const popularRows = [7, 8, 9];

function getPriorityRows() {
  const allRows = [...Array(rows).keys()];
  const used = new Set([...mostPopularRows, ...popularRows]);
  const lessPopular = allRows.filter(r => !used.has(r));
  return [...mostPopularRows, ...popularRows, ...lessPopular];
}

function createSeat(row, col, type = "available") {
  return { row, col, type, groupId: null };
}

function initGrid() {
  grid = [];
  for (let r = 0; r < rows; r++) {
    const row = [];
    for (let c = 0; c < cols; c++) {
      if (seatCols.includes(c)) {
        row.push(createSeat(r, c));
      } else {
        row.push(null);
      }
    }
    grid.push(row);
  }

  vipSeats.forEach(([r, c]) => grid[r][c].type = "vip");
  accessibleSeats.forEach(([r, c]) => grid[r][c].type = "accessible");

  for (let row of grid) {
    for (let seat of row) {
      if (seat && seat.type === "available" && Math.random() < brokenChance) {
        seat.type = "broken";
      }
    }
  }

  renderGrid();
}

function renderGrid() {
  const container = document.getElementById("cinema");
  container.innerHTML = "";

  grid.forEach((row, r) => {
    row.forEach((seat, c) => {
      const div = document.createElement("div");

      if (!seat) {
        div.className = "empty-space";
      } else {
        div.className = `seat ${seat.type}`;

        if (mostPopularRows.includes(r)) {
          div.classList.add("most-popular");
        } else if (popularRows.includes(r)) {
          div.classList.add("popular");
        } else {
          div.classList.add("less-popular");
        }

        const rowLabel = String.fromCharCode(65 + r);
        const seatNumber = seatCols.indexOf(c) + 1;
        const seatLabel = `${rowLabel}${seatNumber}`;
        div.title = `Seat ${seatLabel} - ${seat.type.toUpperCase()}`;
        div.innerText = seatLabel;
      }

      container.appendChild(div);
    });
  });
}

function isValidGroupSpot(row, startCol, groupSize) {
  if (startCol + groupSize > seatCols.length) return false;
  const realCols = seatCols.slice(startCol, startCol + groupSize);
  const blockStart = seatCols[startCol];
  const blockEnd = seatCols[startCol + groupSize - 1];
  if ((blockStart <= 7 && blockEnd > 7) || (blockStart <= 13 && blockEnd > 13)) return false;
  for (let col of realCols) {
    if (grid[row][col].type !== "available") return false;
  }
  return true;
}

function assignGroup(groupSize) {
  const priorityRows = getPriorityRows();
  for (let r of priorityRows) {
    for (let i = 0; i <= seatCols.length - groupSize; i++) {
      if (isValidGroupSpot(r, i, groupSize)) {
        const colsToAssign = seatCols.slice(i, i + groupSize);
        const booking = [];
        for (let col of colsToAssign) {
          grid[r][col].type = "occupied";
          grid[r][col].groupId = `G${groupCounter}`;
          booking.push({ row: r, col });
        }
        bookingHistory.push(booking);
        groupCounter++;
        renderGrid();
        return true;
      }
    }
  }
  alert("No space for group of " + groupSize);
  return false;
}

function assignIndividual() {
  const priorityRows = getPriorityRows();

  // Define corner seats and end seats (these are typically at row ends or corners).
  const cornerSeats = [
    [0, 0], [0, 22], // Top row corners
    [9, 0], [9, 22], // Bottom row corners
    [4, 0], [4, 22], // Middle row corners
    [5, 0], [5, 22]
  ];

  // Function to check if a seat is a corner seat
  function isCornerSeat(r, c) {
    return cornerSeats.some(([row, col]) => row === r && col === c);
  }

  // Function to check if a seat is at the row's end
  function isEndSeat(r, c) {
    return c === seatCols[0] || c === seatCols[seatCols.length - 1];
  }

  // Check for corner seats first
  for (let r of priorityRows) {
    for (let c of seatCols) {
      const seat = grid[r][c];
      if (seat.type === "available" && (isCornerSeat(r, c) || isEndSeat(r, c))) {
        seat.type = "occupied";
        seat.groupId = `S${groupCounter++}`;
        bookingHistory.push([{ row: r, col: c }]);
        renderGrid();
        return true;
      }
    }
  }

  // If no corner/end seat is available, proceed with regular search
  for (let r of priorityRows) {
    for (let c of seatCols) {
      const seat = grid[r][c];
      if (seat.type !== "available") continue;

      const leftIdx = seatCols.indexOf(c) - 1;
      const rightIdx = seatCols.indexOf(c) + 1;
      const left = seatCols[leftIdx] !== undefined ? grid[r][seatCols[leftIdx]] : null;
      const right = seatCols[rightIdx] !== undefined ? grid[r][seatCols[rightIdx]] : null;

      if (left?.type === "occupied" && right?.type === "occupied") continue;

      seat.type = "occupied";
      seat.groupId = `S${groupCounter++}`;
      bookingHistory.push([{ row: r, col: c }]);
      renderGrid();
      return true;
    }
  }

  alert("No space for individual");
  return false;
}

function addGroup() {
  const groupSize = parseInt(document.getElementById("groupSize").value);
  if (isNaN(groupSize) || groupSize < 2 || groupSize > 7) {
    alert("Group size should be between 2 and 7.");
    return;
  }
  assignGroup(groupSize);
}

function cancelLastBooking() {
  if (bookingHistory.length === 0) return;

  const lastBooking = bookingHistory.pop();
  for (let seat of lastBooking) {
    grid[seat.row][seat.col].type = "available";
    grid[seat.row][seat.col].groupId = null;
  }
  renderGrid();
}

function resetSeating() {
  initGrid();
}

initGrid();
  </script>
</body>
</html>
